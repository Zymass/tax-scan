# Тестирование

## Запуск тестов

```bash
npm test
```

## Запуск тестов в watch режиме

```bash
npm run test:watch
```

## Структура тестов

### Тесты логики расчета налогов (`src/utils/__tests__/tax-rules.test.ts`)

Покрывают:
- ✅ Расчет УСН 6% и 15%
- ✅ Расчет НДС с разными ставками
- ✅ Расчет взносов с учетом порогов
- ✅ Валидация входных данных
- ✅ Обработка ошибок с конкретными сообщениями

### Тесты сервиса калькулятора (`src/services/__tests__/tax-calculator.service.test.ts`)

Покрывают:
- ✅ Полный цикл расчета налогов
- ✅ Сравнение режимов налогообложения
- ✅ Рекомендации по режимам
- ✅ Различия между 2025 и 2026 годами
- ✅ Валидация входных данных

## Примеры ошибок валидации

Все функции теперь выбрасывают `TaxCalculationError` с конкретными сообщениями:

- `"Выручка не может быть отрицательной"` - при отрицательной выручке
- `"Расходы не могут превышать выручку"` - при расходах > выручки
- `"УСН недоступен при выручке более 450M руб."` - при превышении лимита
- `"НПД недоступен при наличии сотрудников"` - для самозанятых с сотрудниками
- `"Недопустимая ставка УСН: X. Допустимые: 6, 15"` - при неверной ставке
- И многие другие...

## Добавление новых тестов

1. Создайте файл `*.test.ts` рядом с тестируемым файлом
2. Импортируйте необходимые функции
3. Используйте `describe` и `it` для структурирования тестов
4. Проверяйте как успешные сценарии, так и ошибки

Пример:
```typescript
import { calculateUsnTax, TaxCalculationError } from '../tax-rules';

describe('calculateUsnTax', () => {
  it('should calculate correctly', () => {
    expect(calculateUsnTax(1000000, 6)).toBe(60000);
  });

  it('should throw error for invalid input', () => {
    expect(() => calculateUsnTax(-1000, 6))
      .toThrow(TaxCalculationError);
  });
});
```
